<!-- qr.html: Página para generar el código QR personalizado -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generar QR - VitaQR</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header class="main-header">
    <div class="header-container">
      <div class="logo">
        <img src="img/logo.png" alt="Logo VitaQR">
      </div>
      <nav class="navbar" id="navbar">
        <ul class="menu">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="preguntas-frecuentes.html">Preguntas Frecuentes</a></li>
          <li><a id="abrirSesion"><i class="fas fa-user"></i></a></li>
          <li><a href="carrito.html"><i class="fas fa-shopping-cart"></i></a></li>
        </ul>
      </nav>
      <div id="menu-toggle" class="menu-toggle"><i class="fas fa-bars"></i></div>
    </div>
  </header>

  <main style="text-align:center; padding: 60px 20px;">
    <h1>Tu código QR personalizado</h1>
    <p>Este código redirige a tu información médica de emergencia</p>
    <div id="qrPreview" style="margin: 30px auto;"></div>
    <button onclick="descargarQR()" class="btn" style="max-width: 300px; margin: auto;">Descargar QR</button>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // ID fijo para prueba
    const id = "Exmlv75ZCZOSiA7NUJvH";
    const urlQR = `https://vitaqr.online/qr-info.html?id=${id}`;

    QRCode.toDataURL(urlQR, { width: 200 }, (err, url) => {
      if (!err) {
        const img = new Image();
        img.src = url;
        img.alt = "QR generado";
        document.getElementById("qrPreview").appendChild(img);
        localStorage.setItem("qrGenerado", url);
      }
    });

    function descargarQR() {
      const qr = localStorage.getItem("qrGenerado");
      if (!qr) return alert("Aún no se ha generado el código QR");
      const link = document.createElement("a");
      link.href = qr;
      link.download = "mi_qr_vitaqr.png";
      link.click();
    }
  </script>
</body>
</html>

<!-- qr-info.html: Página pública que muestra la información médica desde Firestore -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Información médica</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header style="background:#EDEEE9; padding:20px; text-align:center; font-weight:bold; font-size:24px; color:#284667;">
    Información médica
  </header>

  <div class="info-container">
    <div class="columna" id="col1">
      <div class="foto-usuario" id="fotoContainer"></div>
    </div>
    <div class="columna" id="col2"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB9j5KqbxMFEC88tbZ1ApUWrKqre01TmcA",
      authDomain: "vitaqronline.firebaseapp.com",
      projectId: "vitaqronline",
      storageBucket: "vitaqronline.appspot.com",
      messagingSenderId: "584669491826",
      appId: "1:584669491826:web:484adb09e2d80e1c8bbc8eb",
      measurementId: "G-2B7W7TL32N"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const etiquetas = {
      nombres: "Nombres",
      apellidos: "Apellidos",
      dni: "DNI",
      edad: "Edad",
      sexo: "Sexo",
      sangre: "Tipo de Sangre",
      nacimiento: "Fecha de Nacimiento",
      nombre_contacto: "Contacto de Emergencia",
      telefono_contacto: "Teléfono de Contacto",
      peso: "Peso",
      altura: "Altura",
      alergias: "Alergias",
      condiciones: "Condiciones Médicas",
      cirugias: "Cirugías",
      vacunas: "Vacunas",
      seguro: "Seguro",
      clinica: "Clínica",
      med_continuos: "Medicamentos Continuos",
      med_emergencia: "Medicamentos Emergencia",
      antecedentes_alergia: "Antecedentes de Alergia",
      enfermedades_hereditarias: "Enfermedades Hereditarias",
      fuma: "¿Fuma?",
      bebe: "¿Bebe?"
    };

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    const col1 = document.getElementById("col1");
    const col2 = document.getElementById("col2");

    if (id) {
      const ref = doc(db, "usuarios", id);
      getDoc(ref).then((docSnap) => {
        if (docSnap.exists()) {
          const datos = docSnap.data();

          // Mostrar imagen
          if (datos.fotoBase64) {
            const img = new Image();
            img.src = datos.fotoBase64;
            img.alt = "Foto de perfil";
            img.style.maxWidth = "150px";
            img.style.borderRadius = "50%";
            img.style.border = "4px solid #284667";
            document.getElementById("fotoContainer").appendChild(img);
          }

          // Mostrar datos
          const claves = Object.keys(etiquetas);
          claves.forEach((clave, index) => {
            if (datos[clave]) {
              const div = document.createElement("div");
              div.className = "dato";
              div.innerHTML = `<strong>${etiquetas[clave]}:</strong> ${datos[clave]}`;
              if (index % 2 === 0) {
                col1.appendChild(div);
              } else {
                col2.appendChild(div);
              }
            }
          });
        } else {
          col1.innerHTML = "<p>❌ No se encontró información.</p>";
        }
      });
    } else {
      col1.innerHTML = "<p>❌ ID no especificado en la URL.</p>";
    }
  </script>
</body>
</html>
