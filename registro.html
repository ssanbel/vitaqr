<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro - VidaQR</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
  <style>
    body { font-family: Helvetica, sans-serif; background: #EDEEE9; margin: 0; padding: 0; }
    header, footer { background: #284667; color: white; padding: 1em; text-align: center; }
    .container { max-width: 800px; margin: 2em auto; background: white; padding: 2em; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 1em; }
    input, select, textarea {
      width: 100%; padding: 0.7em; margin-top: 0.3em; border: 1px solid #ccc; border-radius: 5px;
    }
    input.error, select.error, textarea.error {
      border-color: red;
    }
    .btn { background: #AA443F; color: white; border: none; padding: 0.8em 1.5em; border-radius: 5px; cursor: pointer; margin-top: 1.5em; }
    .btn:hover { background: #8d3531; }
    .success, .error-msg {
      margin-top: 1em; padding: 1em; border-radius: 5px; text-align: center;
    }
    .success { background: #d4edda; color: #155724; }
    .error-msg { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>

<header>
  <h1>VidaQR - Registro Médico</h1>
</header>

<div class="container">
  <h2>Completa tu información médica</h2>
  <form id="registroForm">
    <label>Nombres: <input type="text" name="nombres" /></label>
    <label>Apellidos: <input type="text" name="apellidos" /></label>
    <label>DNI: <input type="text" name="dni" /></label>
    <label>Fecha de nacimiento: <input type="date" name="fechaNacimiento" /></label>
    <label>Teléfono: <input type="text" name="telefono" /></label>
    <label>Contacto de emergencia: <input type="text" name="contactoEmergencia" /></label>
    <label>Tipo de sangre: <input type="text" name="tipoSangre" /></label>
    <label>¿Padece alguna enfermedad?: <textarea name="enfermedades"></textarea></label>
    <label>¿Toma medicamentos?: <textarea name="medicamentos"></textarea></label>
    <label>¿Tiene alergias?: <textarea name="alergias"></textarea></label>
    <label>¿Fuma?: 
      <select name="fuma">
        <option value="">Seleccionar</option>
        <option value="sí">Sí</option>
        <option value="no">No</option>
      </select>
    </label>
    <label>¿Consume alcohol?: 
      <select name="alcohol">
        <option value="">Seleccionar</option>
        <option value="sí">Sí</option>
        <option value="no">No</option>
      </select>
    </label>
    <label>Actividad física: 
      <select name="actividadFisica">
        <option value="">Seleccionar</option>
        <option value="ninguna">Ninguna</option>
        <option value="ocasional">Ocasional</option>
        <option value="frecuente">Frecuente</option>
      </select>
    </label>

    <button type="submit" class="btn">Guardar datos</button>
    <div id="mensaje"></div>
  </form>
</div>

<footer>
  <p>&copy; 2025 VidaQR. Todos los derechos reservados. | <a href="terminos-condiciones.html" style="color: white;">Términos y condiciones</a></p>
</footer>

<script>
  // Configuración Firebase
  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_SENDER_ID",
    appId: "TU_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const form = document.getElementById('registroForm');
  const mensaje = document.getElementById('mensaje');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    mensaje.innerHTML = "";
    
    const datos = {};
    let errorEncontrado = false;

    [...form.elements].forEach(el => {
      if (el.name && el.type !== 'submit') {
        const valor = el.value.trim();
        datos[el.name] = valor;
        el.classList.remove('error');
        if (valor === "" && (el.tagName === "INPUT" || el.tagName === "TEXTAREA")) {
          el.classList.add('error');
          errorEncontrado = true;
        }
      }
    });

    try {
      const user = await new Promise((resolve, reject) => {
        const unsubscribe = auth.onAuthStateChanged(u => {
          unsubscribe();
          u ? resolve(u) : reject("No has iniciado sesión.");
        });
      });

      await db.collection("usuarios").doc(user.uid).set(datos, { merge: true });

      mensaje.innerHTML = "<div class='success'>✅ Datos guardados correctamente.</div>";
    } catch (err) {
      console.error("Error al guardar:", err);
      mensaje.innerHTML = `<div class="error-msg">❌ ${err.message || err}</div>`;
    }
  });
</script>

</body>
</html>
